import "simpleitk"
import "strings"

let img = ReadImage("tests/chris_t1.nii.gz")
let mm = MinimumMaximum(img)
let lo = index(mm,0)
let hi = index(mm,1)

// Build 100 fractional thresholds linearly spaced between lo and hi (inclusive).
let idxs = range(0,100)
let mk_threshold(i) = lo + (hi-lo) * i / 99
let mk_mask(i) = BinaryThreshold(img, mk_threshold(i), hi, 1, 0)

// Build clean output filenames.
let fname(i) = format_string("tests/output/threshold_sweep/mask_{:03.0f}.nii.gz", i)

// Write each thresholded image to disk.
let save_mask(i) = WriteImage(mk_mask(i), fname(i))
let writes = map(save_mask, idxs)

// Force evaluation/materialization.
print "n_thresholds" 100
print "writes" writes
