<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VoxLogicA Studio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&family=Manrope:wght@400;500;700;800&family=Sora:wght@500;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/static/app.css">
</head>

<body>
  <div class="background-layer"></div>
  <div class="shell">
    <header class="topbar">
      <div>
        <p class="eyebrow">VoxLogicA Serve</p>
        <h1>VoxLogicA Studio Console</h1>
      </div>
      <div class="topbar-meta">
        <span id="buildStamp" class="chip">Loading...</span>
      </div>
    </header>

    <nav class="tabbar" aria-label="Main pages">
      <button class="tab active" data-tab="playground">Playground</button>
      <button class="tab" data-tab="results">Results Explorer</button>
      <button class="tab" data-tab="gallery">Example Gallery</button>
      <button class="tab" data-tab="quality">Test Intelligence</button>
      <button class="tab" data-tab="storage">Storage Stats</button>
    </nav>

    <main class="content">
      <section class="panel active" id="tab-playground">
        <div class="grid-two">
          <article class="card editor-card">
            <div class="card-header">
              <h2>Interactive Playground</h2>
              <div class="row gap-s">
                <label class="inline-control" for="executionStrategy">Strategy</label>
                <select id="executionStrategy" class="select">
                  <option value="strict">strict</option>
                  <option value="dask" selected>dask</option>
                </select>
              </div>
            </div>
            <div id="editorShell" class="editor-shell">
              <textarea id="programInput" class="code-input" spellcheck="false">// Paste or load an example.
import "simpleitk"
let x = 2 + 3
print "sum" x</textarea>
            </div>
            <div class="row controls">
              <label class="inline-control" for="programLibrarySelect">Program Library</label>
              <select id="programLibrarySelect" class="select"></select>
              <button id="loadProgramFileBtn" class="btn btn-ghost btn-small">Load from Library</button>
            </div>
            <p id="programLibraryMeta" class="muted"></p>
            <p class="muted">
              Variables are directly clickable in the editor. Hover changes appearance, click resolves on demand with
              priority even when no full run has been launched.
            </p>
            <div class="row controls">
              <button id="runProgramBtn" class="btn btn-primary hidden">Run Program</button>
              <button id="killProgramBtn" class="btn btn-danger" disabled>Kill Running Job</button>
              <button id="clearOutputBtn" class="btn btn-ghost">Clear Output</button>
              <span id="jobStatus" class="chip neutral">idle</span>
            </div>
            <div id="runError" class="inline-error hidden"></div>
          </article>

          <article class="card telemetry-card">
            <div class="card-header">
              <h2>Runtime Telemetry</h2>
              <button id="refreshJobsBtn" class="btn btn-ghost btn-small">Refresh</button>
            </div>
            <div class="stats-grid">
              <div class="stat">
                <span class="label">Wall Time</span>
                <strong id="metricWall">-</strong>
              </div>
              <div class="stat">
                <span class="label">CPU Time</span>
                <strong id="metricCpu">-</strong>
              </div>
              <div class="stat">
                <span class="label">CPU Util.</span>
                <strong id="metricCpuUtil">-</strong>
              </div>
              <div class="stat">
                <span class="label">Peak Python Heap</span>
                <strong id="metricHeapPeak">-</strong>
              </div>
              <div class="stat">
                <span class="label">RSS Delta</span>
                <strong id="metricRssDelta">-</strong>
              </div>
              <div class="stat">
                <span class="label">Current Job</span>
                <strong id="metricJobId">-</strong>
              </div>
            </div>
            <h3 class="subheading">Recent Jobs</h3>
            <div id="recentJobs" class="job-list"></div>
            <h3 class="subheading">Focused Result</h3>
            <div class="row gap-s controls">
              <label class="inline-control" for="playResultSelector">Target</label>
              <select id="playResultSelector" class="select">
                <option value="">Run a query first</option>
              </select>
            </div>
            <p id="playResultMeta" class="muted">Choose a print label or variable to inspect.</p>
            <div id="playResultInspector" class="result-inspector compact"></div>
            <h3 class="subheading">Execution Log</h3>
            <p id="playExecSummary" class="muted">No execution trace yet.</p>
            <div id="playExecLog" class="table-like muted">Run a query to see computed vs cached nodes.</div>
            <pre id="playExecRaw" class="mono-scroll compact-log"></pre>
          </article>
        </div>

        <div class="grid-two">
          <article class="card">
            <h2>Execution Result</h2>
            <pre id="executionOutput" class="mono-scroll"></pre>
          </article>
          <article class="card">
            <h2>Task Graph (Text)</h2>
            <pre id="taskGraphOutput" class="mono-scroll"></pre>
          </article>
        </div>
      </section>

      <section class="panel" id="tab-results">
        <div class="grid-two">
          <article class="card">
            <div class="card-header">
              <h2>Stored Results</h2>
              <button id="refreshResultsBtn" class="btn btn-ghost btn-small">Refresh</button>
            </div>
            <div class="row gap-s controls">
              <label class="inline-control" for="resultStatusFilter">Status</label>
              <select id="resultStatusFilter" class="select">
                <option value="">all</option>
                <option value="materialized">materialized</option>
                <option value="failed">failed</option>
              </select>
              <input id="resultSearchInput" class="input" type="search" placeholder="Filter by node id">
            </div>
            <p id="resultListMeta" class="muted"></p>
            <div id="resultList" class="job-list"></div>
          </article>
          <article class="card">
            <h2>Result Inspector</h2>
            <p class="muted">
              View values only from persisted store entries. Server-side save/export is intentionally disabled.
            </p>
            <div id="resultInspector" class="result-inspector"></div>
          </article>
        </div>
      </section>

      <section class="panel" id="tab-gallery">
        <article class="card">
          <div class="card-header">
            <h2>Progressive Example Gallery</h2>
            <div class="row gap-s">
              <label class="inline-control" for="moduleFilter">Module</label>
              <select id="moduleFilter" class="select">
                <option value="all">all modules</option>
              </select>
            </div>
          </div>
          <p class="muted">
            Gallery cards are generated from markdown directives in
            <code>doc/user/language-gallery.md</code> using
            <code>&lt;!-- vox:playground ... --&gt;</code> comments.
          </p>
          <div id="galleryCards" class="gallery-grid"></div>
        </article>
      </section>

      <section class="panel" id="tab-quality">
        <div class="grid-two">
          <article class="card">
            <div class="card-header">
              <h2>Test & Coverage Overview</h2>
              <div class="row gap-s">
                <button id="refreshQualityBtn" class="btn btn-ghost btn-small">Refresh</button>
                <span id="testRunStatus" class="chip neutral">idle</span>
              </div>
            </div>
            <div class="row controls">
              <button id="runQuickTestsBtn" class="btn btn-ghost btn-small">Run Quick</button>
              <button id="runFullTestsBtn" class="btn btn-primary btn-small">Run Full</button>
              <button id="runPerfTestsBtn" class="btn btn-ghost btn-small">Run Perf</button>
              <button id="killTestRunBtn" class="btn btn-danger btn-small" disabled>Kill Test Run</button>
            </div>
            <div class="stats-grid">
              <div class="stat">
                <span class="label">Total Tests</span>
                <strong id="qTotalTests">-</strong>
              </div>
              <div class="stat">
                <span class="label">Passed</span>
                <strong id="qPassed">-</strong>
              </div>
              <div class="stat">
                <span class="label">Failed</span>
                <strong id="qFailed">-</strong>
              </div>
              <div class="stat">
                <span class="label">Skipped</span>
                <strong id="qSkipped">-</strong>
              </div>
              <div class="stat">
                <span class="label">Duration</span>
                <strong id="qDuration">-</strong>
              </div>
              <div class="stat">
                <span class="label">Line Coverage</span>
                <strong id="qCoverage">-</strong>
              </div>
            </div>
            <h3 class="subheading">Lowest Coverage Packages</h3>
            <div id="coverageBars" class="bars"></div>
          </article>

          <article class="card">
            <h2>VoxLogicA-1 vs VoxLogicA-2 Performance</h2>
            <img id="perfChart" class="perf-chart hidden" alt="Performance comparison chart">
            <div id="perfSummary" class="muted">No performance report yet.</div>
            <h3 class="subheading">Primitive Benchmark Histogram</h3>
            <img id="primitivePerfChart" class="perf-chart hidden" alt="Primitive benchmark histogram">
            <div id="primitivePerfBars" class="bars"></div>
          </article>
        </div>
        <div class="grid-two">
          <article class="card">
            <h2>Test Run Logs</h2>
            <pre id="testRunLog" class="mono-scroll"></pre>
            <h3 class="subheading">Recent Test Jobs</h3>
            <div id="recentTestJobs" class="job-list"></div>
          </article>
          <article class="card">
            <h2>Test Titles</h2>
            <div id="testTitles" class="table-like muted">No junit report loaded.</div>
          </article>
        </div>
        <article class="card">
          <h2>Failing Test Cases</h2>
          <div id="failedCases" class="table-like muted">No failures in current report.</div>
        </article>
      </section>

      <section class="panel" id="tab-storage">
        <div class="grid-two">
          <article class="card">
            <div class="card-header">
              <h2>Cache Footprint</h2>
              <button id="refreshStorageBtn" class="btn btn-ghost btn-small">Refresh</button>
            </div>
            <div class="stats-grid">
              <div class="stat">
                <span class="label">Cached Records</span>
                <strong id="sTotal">-</strong>
              </div>
              <div class="stat">
                <span class="label">Materialized</span>
                <strong id="sMaterialized">-</strong>
              </div>
              <div class="stat">
                <span class="label">Failed</span>
                <strong id="sFailed">-</strong>
              </div>
              <div class="stat">
                <span class="label">Average Payload</span>
                <strong id="sAvgPayload">-</strong>
              </div>
              <div class="stat">
                <span class="label">Total Payload</span>
                <strong id="sTotalPayload">-</strong>
              </div>
              <div class="stat">
                <span class="label">Database Size</span>
                <strong id="sDbSize">-</strong>
              </div>
            </div>
            <p id="storageMeta" class="muted"></p>
          </article>

          <article class="card">
            <h2>Payload Size Distribution</h2>
            <div id="payloadBuckets" class="bars"></div>
            <h3 class="subheading">Runtime Versions</h3>
            <div id="runtimeVersions" class="bars"></div>
          </article>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/@niivue/niivue@0.64.0/dist/niivue.umd.js"></script>
  <script src="/static/results_viewer.js" defer></script>
  <script src="/static/app.js" defer></script>
</body>

</html>
